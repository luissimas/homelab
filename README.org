#+title:Homelab

My Homelab setup running as a [[https://k3s.io/][K3S]] cluster.

* Goals
- GitOps: everything should be deployed and reproducible with Flux
- Secrets should be safely stored in the repository
- SSL certificates for all services
- Monitoring stack with Prometheus and Grafana
- GPU pass-through for hardware acceleration
- Expose services to the outside world
- Monitor all deployed applications
- Reliable storage
- Monitoring alerts

* Repository structure
The repository structure follows the Flux recommendations, but I've also added an extra layer to provide a better separation of concerns. The idea is to have the following dependency graph

#+begin_example
              ┌───►Apps
Infrastructure│
              └───►Core Services
#+end_example

Infrastructure contains controllers and its configurations that do not expose any external services. They provide the fundamental resources to other services such as SSL certificates, secrets management, storage and so on.

Core services are composed of the administrative services exposed from the cluster. This includes any administrative dashboards and monitoring stacks.

Apps are the user-facing services provided by the cluster.

* TODO General infrastructure [3/5]
** DONE Flux [4/4]
CLOSED: [2024-05-01 Wed 20:10]
- [X] GitOps setup with Flux
- [X] Manifests validation in CI
- [X] Ensure bootstrap order is correct
- [X] Flux UI
** DONE Secrets [1/1]
CLOSED: [2024-05-01 Wed 20:10]
- [X] Secrets management
** DONE SSL Certificates [6/6]
CLOSED: [2024-05-01 Wed 20:10]
- [X] SSL certificates
- [X] Secrets replication for certificates
- [X] SSL certificate prod
- [X] Monitoring stack
- [X] Structure the repository
- [X] Persist Prometheus data
** TODO Expose cluster [0/2]
- [ ] Research Cloudflare tunnel vs VPN
- [ ] Implement solution
** TODO Storage [1/5]
- [X] Figure out how to do storage
- [ ] Longhorn basic setup
- [ ] Longhorn UI
- [ ] Multiple disks on longhorn
- [ ] Monitor longhorn with prometheus

[[https://github.com/longhorn/longhorn/issues/265][How to migrate data to longhorn volumes]]
* TODO Monitoring [1/6]
- [X] kube-prometheus-stack deploy
- [ ] Alertmanager setup
- [ ] Provision strava datasource
- [ ] Provision strava dashboard
- [ ] Multiple users on strava dashboard
- [ ] Provision custom Kubernetes dashboard
* TODO Services [0/11]
** TODO Jellyfin [2/3]
- [X] Deploy
- [X] Gpu acceleration
- [ ] Media folder on dedicated drive
** TODO Homepage
** TODO Pihole [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Prowlarr [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO QbitTorrent [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Radarr [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Sonarr [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Readarr [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Calibre [0/2]
- [ ] Deploy
- [ ] Monitoring
** TODO Bazarr [0/2]
- [ ] Deploy
- [ ] Monitoring
